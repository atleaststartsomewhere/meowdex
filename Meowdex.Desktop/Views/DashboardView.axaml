<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="Meowdex.Desktop.Views.DashboardView">
  <ScrollViewer>
    <StackPanel Spacing="16" Margin="24">
      <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto" Margin="0,0,0,8">
        <TextBlock Text="The Meowdex" FontSize="26" FontWeight="Bold" />
        <Button Grid.Column="1" Classes="icon-btn" Content="⚙" Click="OnSettings" />
        <TextBlock Grid.Row="1" Text="Configure recommendation settings and review the latest breeding plan." />
      </Grid>

      <Grid ColumnDefinitions="*,Auto">
        <StackPanel Orientation="Horizontal" Spacing="8">
          <ToggleButton Classes="tab-tracker"
                        IsChecked="{Binding ActiveSection, Converter={StaticResource EqualsConverter}, ConverterParameter=Snapshot, Mode=OneWay}"
                        Command="{Binding SetSectionCommand}"
                        CommandParameter="Snapshot">Snapshot</ToggleButton>
          <ToggleButton Classes="tab-tracker"
                        IsChecked="{Binding ActiveSection, Converter={StaticResource EqualsConverter}, ConverterParameter=Adventuring, Mode=OneWay}"
                        Command="{Binding SetSectionCommand}"
                        CommandParameter="Adventuring">Adventuring Team</ToggleButton>
          <ToggleButton Classes="tab-tracker"
                        IsChecked="{Binding ActiveSection, Converter={StaticResource EqualsConverter}, ConverterParameter=Breeding, Mode=OneWay}"
                        Command="{Binding SetSectionCommand}"
                        CommandParameter="Breeding">Breeding Pool</ToggleButton>
          <ToggleButton Classes="tab-tracker"
                        IsChecked="{Binding ActiveSection, Converter={StaticResource EqualsConverter}, ConverterParameter=General, Mode=OneWay}"
                        Command="{Binding SetSectionCommand}"
                        CommandParameter="General">General Population</ToggleButton>
          <ToggleButton Classes="tab-tracker"
                        IsChecked="{Binding ActiveSection, Converter={StaticResource EqualsConverter}, ConverterParameter=FullRoster, Mode=OneWay}"
                        Command="{Binding SetSectionCommand}"
                        CommandParameter="FullRoster">Full Roster</ToggleButton>
        </StackPanel>
        <Button Grid.Column="1" Classes="primary" Content="Add Cat" Click="OnAddCat" />
      </Grid>

      <StackPanel Spacing="16">
        <StackPanel Spacing="8"
                    IsVisible="{Binding ActiveSection, Converter={StaticResource EqualsConverter}, ConverterParameter=Snapshot}">
          <TextBlock Text="Snapshot" FontSize="18" FontWeight="SemiBold" />
          <Grid ColumnDefinitions="*,*,*">
            <Border Grid.Column="0" Classes="overlay-panel" Padding="12" Margin="0,0,8,0">
              <StackPanel Spacing="6">
                <TextBlock Text="Coverage" FontWeight="SemiBold" />
                <TextBlock FontSize="20" FontWeight="Bold"
                           Text="{Binding CoverageSummary}" />
                <TextBlock Text="{Binding CoveragePercent, StringFormat={}{0:F0}% total mask coverage}" />
                <TextBlock Text="{Binding MissingStatSummary}" TextWrapping="Wrap" />
                <TextBlock Classes="muted"
                           Text="{Binding Plan.CoveredMask, Converter={StaticResource MaskConverter}, StringFormat=Mask: {0}}" />
              </StackPanel>
            </Border>

            <Border Grid.Column="1" Classes="overlay-panel" Padding="12" Margin="4,0">
              <StackPanel Spacing="6">
                <TextBlock Text="Risks" FontWeight="SemiBold" />
                <TextBlock Text="{Binding RiskSummary}" TextWrapping="Wrap" />
                <TextBlock Text="{Binding RetiredCount, StringFormat=Retired cats: {0}}" />
                <TextBlock Text="{Binding Plan.BreedingPool.Count, StringFormat=Breeding pool size: {0}}" />
                <TextBlock Text="{Binding NaturalSevenSummary}" />
              </StackPanel>
            </Border>

            <Border Grid.Column="2" Classes="overlay-panel" Padding="12" Margin="8,0,0,0">
              <StackPanel Spacing="8">
                <TextBlock Text="Next Actions" FontWeight="SemiBold" />
                <TextBlock TextWrapping="Wrap" Text="{Binding NextActionSummary}" />
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <Button Content="Open Breeding"
                          Command="{Binding SetSectionCommand}"
                          CommandParameter="Breeding" />
                  <Button Content="Open Full Roster"
                          Command="{Binding SetSectionCommand}"
                          CommandParameter="FullRoster" />
                </StackPanel>
              </StackPanel>
            </Border>
          </Grid>
        </StackPanel>

        <StackPanel Spacing="10"
                    IsVisible="{Binding ActiveSection, Converter={StaticResource EqualsConverter}, ConverterParameter=Adventuring}">
          <TextBlock Text="Adventuring Team" FontSize="18" FontWeight="SemiBold" />
          <CheckBox Content="AUTO ON" IsChecked="{Binding TeamAutoEnabled}" />

          <ItemsControl ItemsSource="{Binding RowPriorities}">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <TextBlock Width="40" Text="{Binding RowIndex, StringFormat=# {0}}" />
                  <ComboBox Width="140"
                            ItemsSource="{Binding DataContext.RowChoiceOptions, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            SelectedItem="{Binding Choice}"
                            IsEnabled="{Binding DataContext.TeamAutoEnabled, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolNot}}" />
                </StackPanel>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>

          <DataGrid x:Name="AdventuringGrid"
                    ItemsSource="{Binding AdventuringTeam}"
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    Height="240">
            <DataGrid.Columns>
              <DataGridTextColumn Header="Stat Priority" Binding="{Binding Choice}" Width="140" />
              <DataGridTemplateColumn Header="Name" Width="*">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                      <TextBlock Text="{Binding Cat.Name}" />
                      <TextBlock Classes="muted"
                                 FontSize="11"
                                 Text="{Binding Cat.Id, StringFormat=(#{0})}" />
                    </StackPanel>
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTextColumn Header="Current &#x03BC;" Binding="{Binding Cat.CurrentAverage, StringFormat={}{0:F2}}" Width="100" />
              <DataGridTextColumn Header="STR C" Binding="{Binding Cat.StrengthCurrent}" Width="62" />
              <DataGridTextColumn Header="DEX C" Binding="{Binding Cat.DexterityCurrent}" Width="62" />
              <DataGridTextColumn Header="STA C" Binding="{Binding Cat.StaminaCurrent}" Width="62" />
              <DataGridTextColumn Header="INT C" Binding="{Binding Cat.IntellectCurrent}" Width="62" />
              <DataGridTextColumn Header="SPD C" Binding="{Binding Cat.SpeedCurrent}" Width="62" />
              <DataGridTextColumn Header="CHA C" Binding="{Binding Cat.CharismaCurrent}" Width="62" />
              <DataGridTextColumn Header="LCK C" Binding="{Binding Cat.LuckCurrent}" Width="62" />
            </DataGrid.Columns>
          </DataGrid>
          <TextBlock Text="Team excludes breeders and retired cats." />
        </StackPanel>

        <StackPanel Spacing="10"
                    IsVisible="{Binding ActiveSection, Converter={StaticResource EqualsConverter}, ConverterParameter=Breeding}">
          <TextBlock Text="Breeding Pool Roster" FontSize="18" FontWeight="SemiBold" />
          <TextBlock Classes="muted"
                     FontSize="11"
                     Text="{Binding TopCatCount, StringFormat=Top breeders: {0}}"
                     />
          <TextBlock Classes="muted"
                     FontSize="11"
                     Text="{Binding BackfillsPerMask, StringFormat=Backfill partners per mask: {0}}"
                     />
          <DataGrid x:Name="BreedingPoolGrid"
                    ItemsSource="{Binding Plan.BreedingPool}"
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    Sorting="OnBreedingPoolSorting">
            <DataGrid.Columns>
              <DataGridTemplateColumn Header="Name" Width="260" SortMemberPath="NameWithId">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <Grid ColumnDefinitions="*,Auto">
                      <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="{Binding Cat.Name}" />
                        <TextBlock Classes="muted"
                                   FontSize="11"
                                   Text="{Binding Cat.Id, StringFormat=(#{0})}" />
                      </StackPanel>
                      <TextBlock Grid.Column="1"
                                 Margin="8,0,0,0"
                                 HorizontalAlignment="Right"
                                 VerticalAlignment="Center"
                                 IsVisible="{Binding Cat.IsRetired}"
                                 Text="♛"
                                 FontSize="14"
                                 Foreground="#F6C84B" />
                    </Grid>
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTemplateColumn Header="Gender" Width="74" SortMemberPath="GenderSortKey">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <Image Classes="identity-icon"
                           Width="18"
                           Height="18"
                           HorizontalAlignment="Center"
                           Source="{Binding Cat.Gender, Converter={StaticResource GenderIconConverter}}" />
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTemplateColumn Header="Sexuality" Width="86" SortMemberPath="SexualitySortKey">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <Image Classes="identity-icon"
                           Width="18"
                           Height="18"
                           HorizontalAlignment="Center"
                           Source="{Binding Cat.Sexuality, Converter={StaticResource SexualityIconConverter}}" />
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTextColumn Header="# Partners" Binding="{Binding CompatiblePartners}" Width="88" SortMemberPath="CompatiblePartners" />
              <DataGridTextColumn Header="#7s" Binding="{Binding Cat.BaseSevenCount}" Width="62" SortMemberPath="Cat.BaseSevenCount" />
              <DataGridTextColumn Header="Current &#x03BC;" Binding="{Binding Cat.CurrentAverage, StringFormat={}{0:F2}}" Width="98" SortMemberPath="Cat.CurrentAverage" />
              <DataGridTextColumn Header="Base &#x03BC;" Binding="{Binding Cat.BaseAverage, StringFormat={}{0:F2}}" Width="84" SortMemberPath="Cat.BaseAverage" />
              <DataGridTextColumn Header="STR" Binding="{Binding StrMark}" Width="56" SortMemberPath="StrSortKey" />
              <DataGridTextColumn Header="DEX" Binding="{Binding DexMark}" Width="56" SortMemberPath="DexSortKey" />
              <DataGridTextColumn Header="STA" Binding="{Binding StaMark}" Width="56" SortMemberPath="StaSortKey" />
              <DataGridTextColumn Header="INT" Binding="{Binding IntMark}" Width="56" SortMemberPath="IntSortKey" />
              <DataGridTextColumn Header="SPD" Binding="{Binding SpdMark}" Width="56" SortMemberPath="SpdSortKey" />
              <DataGridTextColumn Header="CHA" Binding="{Binding ChaMark}" Width="56" SortMemberPath="ChaSortKey" />
              <DataGridTextColumn Header="LCK" Binding="{Binding LukMark}" Width="56" SortMemberPath="LukSortKey" />
            </DataGrid.Columns>
          </DataGrid>
        </StackPanel>

        <StackPanel Spacing="10"
                    IsVisible="{Binding ActiveSection, Converter={StaticResource EqualsConverter}, ConverterParameter=General}">
          <TextBlock Text="General Population Roster" FontSize="18" FontWeight="SemiBold" />
          <DataGrid x:Name="GeneralPopulationGrid"
                    ItemsSource="{Binding Plan.GeneralPopulation}"
                    AutoGenerateColumns="False"
                    IsReadOnly="True">
            <DataGrid.Columns>
              <DataGridTemplateColumn Header="Name" Width="260" SortMemberPath="Cat.Name">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <Grid ColumnDefinitions="*,Auto">
                      <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="{Binding Cat.Name}" />
                        <TextBlock Classes="muted"
                                   FontSize="11"
                                   Text="{Binding Cat.Id, StringFormat=(#{0})}" />
                      </StackPanel>
                      <TextBlock Grid.Column="1"
                                 Margin="8,0,0,0"
                                 HorizontalAlignment="Right"
                                 VerticalAlignment="Center"
                                 IsVisible="{Binding Cat.IsRetired}"
                                 Text="♛"
                                 FontSize="14"
                                 Foreground="#F6C84B" />
                    </Grid>
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTemplateColumn Header="Gender" Width="74" SortMemberPath="Cat.Gender">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <Image Classes="identity-icon"
                           Width="18"
                           Height="18"
                           HorizontalAlignment="Center"
                           Source="{Binding Cat.Gender, Converter={StaticResource GenderIconConverter}}" />
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTemplateColumn Header="Sexuality" Width="86" SortMemberPath="Cat.Sexuality">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <Image Classes="identity-icon"
                           Width="18"
                           Height="18"
                           HorizontalAlignment="Center"
                           Source="{Binding Cat.Sexuality, Converter={StaticResource SexualityIconConverter}}" />
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTextColumn Header="Current &#x03BC;" Binding="{Binding Cat.CurrentAverage, StringFormat={}{0:F2}}" Width="98" SortMemberPath="Cat.CurrentAverage" />
              <DataGridTextColumn Header="Base &#x03BC;" Binding="{Binding Cat.BaseAverage, StringFormat={}{0:F2}}" Width="84" SortMemberPath="Cat.BaseAverage" />
              <DataGridTextColumn Header="STR C" Binding="{Binding Cat.StrengthCurrent}" Width="62" SortMemberPath="Cat.StrengthCurrent" />
              <DataGridTextColumn Header="STR B" Binding="{Binding Cat.StrengthBase}" Width="62" SortMemberPath="Cat.StrengthBase" />
              <DataGridTextColumn Header="DEX C" Binding="{Binding Cat.DexterityCurrent}" Width="62" SortMemberPath="Cat.DexterityCurrent" />
              <DataGridTextColumn Header="DEX B" Binding="{Binding Cat.DexterityBase}" Width="62" SortMemberPath="Cat.DexterityBase" />
              <DataGridTextColumn Header="STA C" Binding="{Binding Cat.StaminaCurrent}" Width="62" SortMemberPath="Cat.StaminaCurrent" />
              <DataGridTextColumn Header="STA B" Binding="{Binding Cat.StaminaBase}" Width="62" SortMemberPath="Cat.StaminaBase" />
              <DataGridTextColumn Header="INT C" Binding="{Binding Cat.IntellectCurrent}" Width="62" SortMemberPath="Cat.IntellectCurrent" />
              <DataGridTextColumn Header="INT B" Binding="{Binding Cat.IntellectBase}" Width="62" SortMemberPath="Cat.IntellectBase" />
              <DataGridTextColumn Header="SPD C" Binding="{Binding Cat.SpeedCurrent}" Width="62" SortMemberPath="Cat.SpeedCurrent" />
              <DataGridTextColumn Header="SPD B" Binding="{Binding Cat.SpeedBase}" Width="62" SortMemberPath="Cat.SpeedBase" />
              <DataGridTextColumn Header="CHA C" Binding="{Binding Cat.CharismaCurrent}" Width="62" SortMemberPath="Cat.CharismaCurrent" />
              <DataGridTextColumn Header="CHA B" Binding="{Binding Cat.CharismaBase}" Width="62" SortMemberPath="Cat.CharismaBase" />
              <DataGridTextColumn Header="LCK C" Binding="{Binding Cat.LuckCurrent}" Width="62" SortMemberPath="Cat.LuckCurrent" />
              <DataGridTextColumn Header="LCK B" Binding="{Binding Cat.LuckBase}" Width="62" SortMemberPath="Cat.LuckBase" />
            </DataGrid.Columns>
          </DataGrid>
        </StackPanel>

        <StackPanel Spacing="10"
                    IsVisible="{Binding ActiveSection, Converter={StaticResource EqualsConverter}, ConverterParameter=FullRoster}">
          <TextBlock Text="Full Roster" FontSize="18" FontWeight="SemiBold" />
          <DataGrid x:Name="FullRosterGrid"
                    ItemsSource="{Binding Cats}"
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    Height="520"
                    CanUserSortColumns="True"
                    SelectionMode="Single"
                    HeadersVisibility="Column"
                    HorizontalScrollBarVisibility="Auto">
            <DataGrid.Columns>
              <DataGridTemplateColumn Header="Name" Width="260" SortMemberPath="Name">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <Grid ColumnDefinitions="*,Auto">
                      <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="{Binding Name}" />
                        <TextBlock Classes="muted"
                                   FontSize="11"
                                   Text="{Binding Id, StringFormat=(#{0})}" />
                      </StackPanel>
                      <TextBlock Grid.Column="1"
                                 Margin="8,0,0,0"
                                 HorizontalAlignment="Right"
                                 VerticalAlignment="Center"
                                 IsVisible="{Binding IsRetired}"
                                 Text="♛"
                                 FontSize="14"
                                 Foreground="#F6C84B" />
                    </Grid>
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTemplateColumn Header="Gender" Width="74" SortMemberPath="Gender">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <Image Classes="identity-icon"
                           Width="18"
                           Height="18"
                           HorizontalAlignment="Center"
                           Source="{Binding Gender, Converter={StaticResource GenderIconConverter}}" />
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTemplateColumn Header="Sexuality" Width="86" SortMemberPath="Sexuality">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <Image Classes="identity-icon"
                           Width="18"
                           Height="18"
                           HorizontalAlignment="Center"
                           Source="{Binding Sexuality, Converter={StaticResource SexualityIconConverter}}" />
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
              <DataGridTextColumn Header="Current &#x03BC;" Binding="{Binding CurrentAverage, StringFormat={}{0:F2}}" Width="98" SortMemberPath="CurrentAverage" />
              <DataGridTextColumn Header="Base &#x03BC;" Binding="{Binding BaseAverage, StringFormat={}{0:F2}}" Width="84" SortMemberPath="BaseAverage" />
              <DataGridTextColumn Header="STR C" Binding="{Binding StrengthCurrent}" Width="62" SortMemberPath="StrengthCurrent" />
              <DataGridTextColumn Header="STR B" Binding="{Binding StrengthBase}" Width="62" SortMemberPath="StrengthBase" />
              <DataGridTextColumn Header="DEX C" Binding="{Binding DexterityCurrent}" Width="62" SortMemberPath="DexterityCurrent" />
              <DataGridTextColumn Header="DEX B" Binding="{Binding DexterityBase}" Width="62" SortMemberPath="DexterityBase" />
              <DataGridTextColumn Header="STA C" Binding="{Binding StaminaCurrent}" Width="62" SortMemberPath="StaminaCurrent" />
              <DataGridTextColumn Header="STA B" Binding="{Binding StaminaBase}" Width="62" SortMemberPath="StaminaBase" />
              <DataGridTextColumn Header="INT C" Binding="{Binding IntellectCurrent}" Width="62" SortMemberPath="IntellectCurrent" />
              <DataGridTextColumn Header="INT B" Binding="{Binding IntellectBase}" Width="62" SortMemberPath="IntellectBase" />
              <DataGridTextColumn Header="SPD C" Binding="{Binding SpeedCurrent}" Width="62" SortMemberPath="SpeedCurrent" />
              <DataGridTextColumn Header="SPD B" Binding="{Binding SpeedBase}" Width="62" SortMemberPath="SpeedBase" />
              <DataGridTextColumn Header="CHA C" Binding="{Binding CharismaCurrent}" Width="62" SortMemberPath="CharismaCurrent" />
              <DataGridTextColumn Header="CHA B" Binding="{Binding CharismaBase}" Width="62" SortMemberPath="CharismaBase" />
              <DataGridTextColumn Header="LCK C" Binding="{Binding LuckCurrent}" Width="62" SortMemberPath="LuckCurrent" />
              <DataGridTextColumn Header="LCK B" Binding="{Binding LuckBase}" Width="62" SortMemberPath="LuckBase" />
            </DataGrid.Columns>
          </DataGrid>
        </StackPanel>
      </StackPanel>
    </StackPanel>
  </ScrollViewer>
</UserControl>

